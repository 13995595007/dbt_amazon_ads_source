version: 2

sources:
  - name: amazon_ads
    schema: "{{ var('amazon_ads_schema', 'amazon_ads') }}"
    database: "{% if target.type != 'spark'%}{{ var('amazon_ads_database', target.database) }}{% endif %}"

    loader: Fivetran
    loaded_at_field: _fivetran_synced

    freshness: 
      warn_after: {count: 48, period: hour}
      error_after: {count: 168, period: hour}
    # config:
    #       enabled: "{{ var('ad_reporting__amazon_ads_enabled', true) }}"

    tables:
      - name: ad_group_history
        description: Each record represents a version of an ad group in Amazon Ads.
        identifier: "{{ var('amazon_ads_ad_group_history_identifier', 'ad_group_history') }}"
        columns:
          - name: id
            description: "{{ doc('ad_group_id') }}"
          - name: last_update_date
            description: "{{ doc('last_update_date') }}"
          - name: campaign_id
            description: "{{ doc('campaign_id') }}"
          - name: campaign_name
            description: "{{ doc('campaign_name') }}"
          - name: ad_group_name
            description: "{{ doc('ad_group_name') }}"
          - name: serving_status
            description: "{{ doc('ad_group_status') }}"

      - name: ad_group_level_report
        description: Each record represents a version of an ad group in Amazon Ads.
        identifier: "{{ var('amazon_ads_ad_group_history_identifier', 'ad_group_history') }}"
        columns:
          - name: ad_group_id
            description: "{{ doc('ad_group_id') }}"
          - name: campaign_id
            description: "{{ doc('campaign_id') }}"
          - name: clicks
            description: "{{ doc('clicks') }}"
          - name: impressions
            description: "{{ doc('impressions') }}"
          - name: cost
            description: "{{ doc('cost') }}"

      - name: campaign_history
        description: Each record represents a version of a campaign in Amazon Ads.
        identifier: "{{ var('amazon_ads_campaign_history_identifier', 'campaign_history') }}"
        columns:
          - name: id
            description: "{{ doc('campaign_id') }}"
          - name: updated_at
            description: "{{ doc('updated_at') }}"
          - name: ad_network_type
            description: "{{ doc('ad_network_type') }}"
          - name: advertising_channel_type
            description: The type of advertising channel being used by the campaign.
          - name: advertising_channel_subtype
            description: The advertising channel subtype that is being used by the campaign.
          - name: start_date
            description: The start date of the campaign.
          - name: end_date
            description: The end date of the campaign.
          - name: serving_status
            description: Status of the ads and how they are currently being served.
          - name: status
            description: General status of the campaign.
          - name: tracking_url_template
            description: The tracking url template being used throughout the campaign ads.
          - name: device
            description: "{{ doc('device') }}"
          - name: name
            description: "{{ doc('campaign_name') }}"
          - name: customer_id
            description: "{{ doc('external_customer_id') }}"

      - name: account_history
        description: Each record represents a historical version of an account in Amazon Ads.
        identifier: "{{ var('amazon_ads_account_history_identifier', 'account_history') }}"
        columns:
          - name: id
            description: "{{ doc('account_id') }}"
          - name: currency_code
            description: The currency of the spend reported.
          - name: auto_tagging_enabled
            description: Boolean indicating if auto tagging is enabled on the account ads.
          - name: time_zone
            description: The time zone of the account ads.
          - name: descriptive_name
            description: "{{ doc('account_descriptive_name') }}"
          - name: updated_at
            description: "{{ doc('updated_at') }}"

      - name: ad_group_criterion_history
        description: Each record represents a historical version of an ad group criterion in Amazon Ads.
        identifier: "{{ var('amazon_ads_ad_group_criterion_history_identifier', 'ad_group_criterion_history') }}"
        columns:
          - name: id
            description: Unique identifier of the ad group criterion.
          - name: ad_group_id
            description: "{{ doc('ad_group_id') }}"
          - name: base_campaign_id
            description: "{{ doc('campaign_id') }}"
          - name: updated_at
            description: "{{ doc('updated_at') }}"
          - name: type
            description: The type of ad group criterion.
          - name: status
            description: The current status of the ad group criterion.
          - name: keyword_match_type
            description: The match type which dictate how closely the keyword needs to match with the userâ€™s search query so that the ad can be considered for the auction. 
          - name: keyword_text
            description: The text used within the keyword criterion that is being matched against.

      - name: ad_group_stats
        description: Each record represents the daily performance of an ad group in Amazon Ads broken down to the ad network and device type.
        identifier: "{{ var('amazon_ads_ad_group_stats_identifier', 'ad_group_stats') }}"
        columns:
          - name: customer_id
            description: "{{ doc('external_customer_id') }}"
          - name: date
            description: "{{ doc('date') }}"
          - name: id
            description: "{{ doc('ad_group_id') }}"
          - name: ad_network_type
            description: "{{ doc('ad_network_type') }}"
          - name: device
            description: "{{ doc('device') }}"
          - name: campaign_id
            description: "{{ doc('campaign_id') }}"
          - name: clicks
            description: "{{ doc('clicks') }}"
          - name: cost_micros
            description: "{{ doc('cost') }}"
          - name: impressions
            description: "{{ doc('impressions') }}"

      - name: campaign_stats
        description: Each record represents the daily performance of a campaign in Amazon Ads broken down to the ad network and device type.
        identifier: "{{ var('amazon_ads_campaign_stats_identifier', 'campaign_stats') }}"
        columns:
          - name: customer_id
            description: "{{ doc('external_customer_id') }}"
          - name: date
            description: "{{ doc('date') }}"
          - name: id
            description: "{{ doc('campaign_id') }}"
          - name: clicks
            description: "{{ doc('clicks') }}"
          - name: cost_micros
            description: "{{ doc('cost') }}"
          - name: impressions
            description: "{{ doc('impressions') }}"

      - name: keyword_stats
        description: Each record represents the daily performance of a keyword in Amazon Ads.
        identifier: "{{ var('amazon_ads_keyword_stats_identifier', 'keyword_stats') }}"
        columns:
          - name: customer_id
            description: "{{ doc('external_customer_id') }}"
          - name: date
            description: "{{ doc('date') }}"
          - name: ad_group_id
            description: "{{ doc('ad_group_id') }}"
          - name: _fivetran_id
            description: The unique ID of the keyword record.
          - name: campaign_id
            description: "{{ doc('campaign_id') }}"
          - name: ad_group_criterion_criterion_id
            description: Reference to the ad group criterion used for the keyword.
          - name: clicks
            description: "{{ doc('clicks') }}"
          - name: cost_micros
            description: "{{ doc('cost') }}"
          - name: impressions
            description: "{{ doc('impressions') }}"

      - name: account_stats
        description: Each record represents the daily performance of an account in Amazon Ads broken down to the ad network and device type.
        identifier: "{{ var('amazon_ads_account_stats_identifier', 'account_stats') }}"
        columns:
          - name: customer_id
            description: "{{ doc('external_customer_id') }}"
          - name: date
            description: "{{ doc('date') }}"
          - name: ad_network_type
            description: "{{ doc('ad_network_type') }}"
          - name: device
            description: "{{ doc('device') }}"
          - name: clicks
            description: "{{ doc('clicks') }}"
          - name: cost_micros
            description: "{{ doc('cost') }}"
          - name: impressions
            description: "{{ doc('impressions') }}"